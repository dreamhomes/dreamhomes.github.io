<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>数据类别的不平衡问题与过采样方法比较 | 梦家博客</title><meta name="keywords" content="不平衡数据集"><meta name="author" content="梦家"><meta name="copyright" content="梦家"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="背景 数据类不平衡问题（Class-imbalance）是指在训练分类模型时所使用的训练集的标签类别分布不均匀。例如正类样本995个，负类样本仅5个（少数类），这样的数据集中就存在类不平衡问题。 对于不平衡类的研究通常认为不平衡意味着少数类只占少于10%到20%。  对于数据集中类别不平衡的问题是否需要特殊处理，需要取决于训练出来的模型在验证集中的效果，如果效果较好说明没有必要进行处理。  类不平"><meta property="og:type" content="article"><meta property="og:title" content="数据类别的不平衡问题与过采样方法比较"><meta property="og:url" content="https://dreamhomes.top/posts/202005281734/"><meta property="og:site_name" content="梦家博客"><meta property="og:description" content="背景 数据类不平衡问题（Class-imbalance）是指在训练分类模型时所使用的训练集的标签类别分布不均匀。例如正类样本995个，负类样本仅5个（少数类），这样的数据集中就存在类不平衡问题。 对于不平衡类的研究通常认为不平衡意味着少数类只占少于10%到20%。  对于数据集中类别不平衡的问题是否需要特殊处理，需要取决于训练出来的模型在验证集中的效果，如果效果较好说明没有必要进行处理。  类不平"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/butterflyblog/imgs/img3.jpeg"><meta property="article:published_time" content="2020-05-28T17:34:21.000Z"><meta property="article:modified_time" content="2022-05-26T03:15:49.132Z"><meta property="article:author" content="梦家"><meta property="article:tag" content="不平衡数据集"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/butterflyblog/imgs/img3.jpeg"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/favicon.png"><link rel="canonical" href="https://dreamhomes.top/posts/202005281734/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:20,languages:{author:"作者: 梦家",link:"链接: ",source:"来源: 梦家博客",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#6F42C1",bgDark:"#6F42C1",position:"bottom-left"},source:{jQuery:"https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js",justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js",css:"https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css"},fancybox:{js:"https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js",css:"https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"}},isPhotoFigcaption:!0,islazyload:!0,isanchor:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2022-05-26 03:15:49"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const a=864e5*o,c={value:t,expiry:(new Date).getTime()+a};localStorage.setItem(e,JSON.stringify(c))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise((t,o)=>{const a=document.createElement("script");a.src=e,a.async=!0,a.onerror=o,a.onload=a.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme"),o=window.matchMedia("(prefers-color-scheme: dark)").matches,a=window.matchMedia("(prefers-color-scheme: light)").matches,c=window.matchMedia("(prefers-color-scheme: no-preference)").matches,n=!o&&!a&&!c;if(void 0===t){if(a)activateLightMode();else if(o)activateDarkMode();else if(c||n){const e=(new Date).getHours();e<=6||e>=18?activateDarkMode():activateLightMode()}window.matchMedia("(prefers-color-scheme: dark)").addListener((function(e){void 0===saveToLocal.get("theme")&&(e.matches?activateDarkMode():activateLightMode())}))}else"light"===t?activateLightMode():activateDarkMode();const i=saveToLocal.get("aside-status");void 0!==i&&("hide"===i?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));const r=saveToLocal.get("global-font-size");void 0!==r&&document.documentElement.style.setProperty("--global-font-size",r+"px")})(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/css/custom.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/css/custom/twikoo_beautify.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload='this.media="all"'><meta name="generator" content="Hexo 5.4.1"><link rel="alternate" href="/atom.xml" title="梦家博客" type="application/atom+xml"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/avatar.gif" onerror='onerror=null,src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/friend_404.gif"' alt="avatar"></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">274</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">183</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">63</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i> <span>娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i> <span>书单</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i> <span>电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comments"></i> <span>留言</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://sites.google.com/site/mengjiashen01/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/butterflyblog/imgs/img3.jpeg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">梦家博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i> <span>娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i> <span>书单</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i> <span>电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comments"></i> <span>留言</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://sites.google.com/site/mengjiashen01/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">数据类别的不平衡问题与过采样方法比较</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-05-28T17:34:21.000Z" title="发表于 2020-05-28 17:34:21">2020-05-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-26T03:15:49.132Z" title="更新于 2022-05-26 03:15:49">2022-05-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E7%AE%97%E6%B3%95%E7%90%86%E8%AE%BA/">算法理论</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>12分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/posts/202005281734/#post-comment"><span id="twikoo-count"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="背景">背景</h2><p>数据类不平衡问题（Class-imbalance）是指在训练分类模型时所使用的训练集的标签类别分布不均匀。例如正类样本995个，负类样本仅5个（少数类），这样的数据集中就存在类不平衡问题。</p><p>对于不平衡类的研究通常认为<strong>不平衡</strong>意味着少数类只占少于10%到20%。</p><blockquote><p>对于数据集中类别不平衡的问题是否需要特殊处理，需要取决于训练出来的模型在验证集中的效果，如果效果较好说明没有必要进行处理。</p></blockquote><p>类不平衡导致的问题可能导致模型出现问题，模型训练过程中某类的样本数量太少说明在训练过程中提供的“特征信息”少，模型对少数类的判定效果差。可能由于验证集准确率较高而终止优化那么会导致模型不知如何去判别出少数类。</p><h2 id="解决方案">解决方案</h2><p>对于数据不平衡问题，当前有不同的方法来缓解：</p><ul><li>取决于数据，不处理时可能效果也不差。</li><li>数据层面上通过某种方法是数据更加平衡：<ul><li>对于少数类进行过采样；</li><li>对于多数类进行欠采样；</li><li>合成新的少数类样本；</li></ul></li><li>舍弃所有少数类，使用异常检测框架。</li><li>算法层面上调整模型：<ul><li>调整类权重；</li><li>调整决策阈值；</li><li>使用已有的算法对少数类更加敏感；</li></ul></li><li>构造一个在不平衡数据上表现效果好的全新算法。</li></ul><p><strong>注意：</strong> 对于不平衡类分类器不要使用准确率（Accuracy）作为评价指标，准确率通常以0.5作为概率阈值来判定所属类别，在不平衡数据集中通常会出错。一般使用ROC、AUC曲线，F1分数。</p><p>列出一张相关采样方法导图：</p><p><img src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/blog/imgs/sampling.png" alt=""></p><p>本文主要学习下常用的 SMOTE 采样方法。</p><p>参考：<a target="_blank" rel="noopener" href="https://imbalanced-learn.readthedocs.io/en/stable/auto_examples/over-sampling/plot_comparison_over_sampling.html#sphx-glr-auto-examples-over-sampling-plot-comparison-over-sampling-py">不同过采样方法之间的量化比较</a></p><h2 id="SMOTE-过采样方法">SMOTE 过采样方法</h2><h3 id="SMOTE-采样">SMOTE 采样</h3><p>SMOTE 基于“插值”的方法为少数类合成新的样本。</p><p>设少数类的样本数为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.13889em">T</span></span></span></span>，那么SMOTE将为少数类合成<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">NT</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.10903em">N</span><span class="mord mathnormal" style="margin-right:.13889em">T</span></span></span></span>个新样本，其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">1\leq N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.78041em;vertical-align:-.13597em"></span><span class="mord">1</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.10903em">N</span></span></span></span>为正整数。</p><p>假设少数类中的一个样本<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.65952em;vertical-align:0"></span><span class="mord mathnormal">i</span></span></span></span> ，特征向量为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>,<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>∈</mo><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><mi>T</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">i\in \{1,...,T\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69862em;vertical-align:-.0391em"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.13889em">T</span><span class="mclose">}</span></span></span></span>：</p><ol><li><p>首先从该少数类<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.13889em">T</span></span></span></span>个样本中选择<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span></span></span></span> 个近邻样本（采用欧式距离），记为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>i</mi><mo stretchy="false">(</mo><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi><mo stretchy="false">)</mo></mrow></msub><mo separator="true">,</mo><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi><mo>∈</mo><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><mi>k</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">x_{i(near)},near\in \{1,\cdots,k\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8942999999999999em;vertical-align:-.3551999999999999em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.34480000000000005em"><span style="top:-2.5198em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:.02778em">r</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.3551999999999999em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="mclose">}</span></span></span></span>;</p></li><li><p>然后从<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span></span></span></span> 个进行的样本中随机选择一个样本<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>i</mi><mo stretchy="false">(</mo><mi>n</mi><mi>n</mi><mo stretchy="false">)</mo></mrow></msub></mrow><annotation encoding="application/x-tex">x_{i(nn)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7857599999999999em;vertical-align:-.3551999999999999em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.34480000000000005em"><span style="top:-2.5198em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.3551999999999999em"><span></span></span></span></span></span></span></span></span></span>，在生成0到1间的随机数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ζ</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\zeta_{1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07378em">ζ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.07378em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>,可以合成一个新的样本<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>i</mi><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">x_{i1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="bold-italic">x</mi><mrow><mi>i</mi><mn>1</mn></mrow></msub><mo>=</mo><msub><mi mathvariant="bold-italic">x</mi><mi>i</mi></msub><mo>+</mo><msub><mi>ζ</mi><mn>1</mn></msub><mo>⋅</mo><mrow><mo fence="true">(</mo><msub><mi mathvariant="bold-italic">x</mi><mrow><mi>i</mi><mo stretchy="false">(</mo><mi>n</mi><mi>n</mi><mo stretchy="false">)</mo></mrow></msub><mo>−</mo><msub><mi mathvariant="bold-italic">x</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\boldsymbol{x}_{i 1}=\boldsymbol{x}_{i}+\zeta_{1} \cdot\left(\boldsymbol{x}_{i(n n)}-\boldsymbol{x}_{i}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.59444em;vertical-align:-.15em"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol">x</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.73333em;vertical-align:-.15em"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol">x</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07378em">ζ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.07378em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.2051999999999998em;vertical-align:-.3551999999999999em"></span><span class="minner"><span class="mopen delimcenter" style="top:0"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol">x</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.34480000000000005em"><span style="top:-2.5198em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.3551999999999999em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol">x</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0"><span class="delimsizing size1">)</span></span></span></span></span></span></span></p></li><li><p>将步骤 2 重负执行<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.10903em">N</span></span></span></span> 次，从而可以合成<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.10903em">N</span></span></span></span> 个新样本：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>i</mi><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msub><mo separator="true">,</mo><mi>n</mi><mi>e</mi><mi>w</mi><mo>∈</mo><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><mi>N</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">x_{inew},new\in \{1,\cdots ,N\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7335400000000001em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:.02691em">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:.02691em">w</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.10903em">N</span><span class="mclose">}</span></span></span></span>。</p></li></ol><p>因此，对所有的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.13889em">T</span></span></span></span> 个少数类样本执行上述操作即可合成<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">NT</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.10903em">N</span><span class="mord mathnormal" style="margin-right:.13889em">T</span></span></span></span> 个新样本。</p><p>SMOTE会随机选取少数类样本用以合成新样本，而不考虑周边样本的情况，这样容易带来两个问题：</p><ol><li>如果选取的少数类样本周围也都是少数类样本，则新合成的样本不会提供太多有用信息。这就像支持向量机中远离margin的点对决策边界影响不大。</li><li>如果选取的少数类样本周围都是多数类样本，这类的样本可能是噪音，则新合成的样本会与周围的多数类样本产生大部分重叠，致使分类困难。</li></ol><p>总体来说我们希望新合成的少数类样本能处于两个类别的边界附近，这样往往能提供足够的信息用以分类。</p><h3 id="Borderline-SMOTE-采样">Borderline SMOTE 采样</h3><p>对于SMOTE方法，Borderline-SMOTE中增加少数类中样本的选择过程。根据所有k-NN样本将少数类样本分为三类：</p><ul><li>“noise” instance：所有的 kNN 样本都属于多数类；</li><li>“danger” instance：超过一半的 kNN 样本属于多数类；</li><li>“safe” instance：超过一半的 kNN 样本属于少数类；</li></ul><p><img src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/blog/imgs/ml-unbalance-data-borderline.png" alt=""></p><p><code>Borderline SMOTE</code>算法只会从处于<strong>danger</strong>状态的样本中随机选择，然后用SMOTE算法产生新的样本。处于<strong>danger</strong>状态的样本代表靠近边界附近的少数类样本，而处于边界附近的样本往往更容易被误分类。因而 <code>Borderline SMOTE</code> 只对那些靠近边界的少数类样本进行人工合成样本，而 <code>SMOTE</code> 则对所有少数类样本一视同仁。</p><p>Border-line SMOTE分为两种: Borderline-1 SMOTE和Borderline-2 SMOTE。 Borderline-1 SMOTE在合成样本时式中的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>i</mi><mo stretchy="false">(</mo><mi>n</mi><mi>n</mi><mo stretchy="false">)</mo></mrow></msub></mrow><annotation encoding="application/x-tex">x_{i(nn)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7857599999999999em;vertical-align:-.3551999999999999em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.34480000000000005em"><span style="top:-2.5198em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.3551999999999999em"><span></span></span></span></span></span></span></span></span></span>是一个少数类样本，而Borderline-2 SMOTE中的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>i</mi><mo stretchy="false">(</mo><mi>n</mi><mi>n</mi><mo stretchy="false">)</mo></mrow></msub></mrow><annotation encoding="application/x-tex">x_{i(nn)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7857599999999999em;vertical-align:-.3551999999999999em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.34480000000000005em"><span style="top:-2.5198em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.3551999999999999em"><span></span></span></span></span></span></span></span></span></span>则是k近邻中的任意一个样本。</p><h3 id="SVM-SMOTE-采样">SVM SMOTE 采样</h3><p>使用一个SVM分类器寻找支持向量，然后在支持向量的基础上合成新的样本。类似Broderline Smote,SVM smote也会根据K近邻的属性决定样本的类型（safe,danger,noice）,然后使用danger的样本训练SVM。</p><h3 id="Kmeans-SMOTE-采样">Kmeans SMOTE 采样</h3><p>在合成样本之前先对样本进行聚类，然后根据簇密度的大小分别对不同簇的负样本进行合成。在聚类步骤中，使用k均值聚类为k个组。过滤选择用于过采样的簇，保留具有高比例的少数类样本的簇。然后，它分配合成样本的数量，将更多样本分配给少数样本稀疏分布的群集。最后，过采样步骤，在每个选定的簇中应用SMOTE以实现少数和多数实例的目标比率。</p><h3 id="SMOTE-NC-采样">SMOTE-NC 采样</h3><p>以上的Smote方法都不能处理分类变量，SMOTE-NC由于分类变量无法计算插值，SMOTE-NC会在合成新样本的时候参考新样本最近邻的该特征，然后区其中出现次数最多的值。</p><h3 id="Python-实现">Python 实现</h3><p>SMOTE 的一个主流实现是来自于sklearn的contrib项目<code>imbalanced_learn</code>，使用imbalanced_learn的smote符合sklearn的API规范。</p><p>参考：<a target="_blank" rel="noopener" href="https://imbalanced-learn.readthedocs.io/en/stable/generated/imblearn.over_sampling.SMOTE.html?highlight=smote">imbalanced-learn/SMOTE</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> make_classification</span><br><span class="line"><span class="keyword">from</span> imblearn.over_sampling <span class="keyword">import</span> SMOTE</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">X, y = make_classification(n_classes=<span class="number">2</span>, class_sep=<span class="number">2</span>, weights=[<span class="number">0.1</span>, <span class="number">0.9</span>], n_informative=<span class="number">1</span>, n_redundant=<span class="number">1</span>, flip_y=<span class="number">0</span>,</span><br><span class="line">                           n_features=<span class="number">2</span>, n_clusters_per_class=<span class="number">1</span>, n_samples=<span class="number">1000</span>, random_state=<span class="number">10</span>)</span><br><span class="line"><span class="comment"># Counter(y)</span></span><br><span class="line"><span class="comment"># Counter(&#123;1: 900, 0: 100&#125;)</span></span><br><span class="line">sm = SMOTE(random_state=<span class="number">42</span>)</span><br><span class="line">X_res, y_res = sm.fit_resample(X, y)</span><br><span class="line"><span class="comment"># Counter(y_res)</span></span><br><span class="line"><span class="comment"># Counter(&#123;1: 900, 0: 900&#125;)</span></span><br></pre></td></tr></table></figure><h2 id="不同过采样方法的比较">不同过采样方法的比较</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> make_classification</span><br><span class="line"><span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> LinearSVC</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> imblearn.pipeline <span class="keyword">import</span> make_pipeline</span><br><span class="line"><span class="keyword">from</span> imblearn.over_sampling <span class="keyword">import</span> ADASYN</span><br><span class="line"><span class="keyword">from</span> imblearn.over_sampling <span class="keyword">import</span> (SMOTE, BorderlineSMOTE, SVMSMOTE, SMOTENC, KMeansSMOTE)</span><br><span class="line"><span class="keyword">from</span> imblearn.over_sampling <span class="keyword">import</span> RandomOverSampler</span><br><span class="line"><span class="keyword">from</span> imblearn.base <span class="keyword">import</span> BaseSampler</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成不平衡数据集</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_dataset</span>(<span class="params">n_samples=<span class="number">1000</span>, weights=(<span class="params"><span class="number">0.01</span>, <span class="number">0.01</span>, <span class="number">0.98</span></span>), n_classes=<span class="number">3</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                   class_sep=<span class="number">0.8</span>, n_clusters=<span class="number">1</span></span>):</span></span><br><span class="line">    <span class="keyword">return</span> make_classification(n_samples=n_samples, n_features=<span class="number">2</span>,</span><br><span class="line">                               n_informative=<span class="number">2</span>, n_redundant=<span class="number">0</span>, n_repeated=<span class="number">0</span>,</span><br><span class="line">                               n_classes=n_classes,</span><br><span class="line">                               n_clusters_per_class=n_clusters,</span><br><span class="line">                               weights=<span class="built_in">list</span>(weights),</span><br><span class="line">                               class_sep=class_sep, random_state=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 图展示过采样结果</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_resampling</span>(<span class="params">X, y, sampling, ax</span>):</span></span><br><span class="line">    X_res, y_res = sampling.fit_resample(X, y)</span><br><span class="line">    ax.scatter(X_res[:, <span class="number">0</span>], X_res[:, <span class="number">1</span>], c=y_res, alpha=<span class="number">0.8</span>, edgecolor=<span class="string">&#x27;k&#x27;</span>)</span><br><span class="line">    <span class="comment"># make nice plotting</span></span><br><span class="line">    ax.spines[<span class="string">&#x27;top&#x27;</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">    ax.spines[<span class="string">&#x27;right&#x27;</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">    ax.get_xaxis().tick_bottom()</span><br><span class="line">    ax.get_yaxis().tick_left()</span><br><span class="line">    ax.spines[<span class="string">&#x27;left&#x27;</span>].set_position((<span class="string">&#x27;outward&#x27;</span>, <span class="number">10</span>))</span><br><span class="line">    ax.spines[<span class="string">&#x27;bottom&#x27;</span>].set_position((<span class="string">&#x27;outward&#x27;</span>, <span class="number">10</span>))</span><br><span class="line">    <span class="keyword">return</span> Counter(y_res)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 判别函数结果</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_decision_function</span>(<span class="params">X, y, clf, ax</span>):</span></span><br><span class="line">    plot_step = <span class="number">0.02</span></span><br><span class="line">    x_min, x_max = X[:, <span class="number">0</span>].<span class="built_in">min</span>() - <span class="number">1</span>, X[:, <span class="number">0</span>].<span class="built_in">max</span>() + <span class="number">1</span></span><br><span class="line">    y_min, y_max = X[:, <span class="number">1</span>].<span class="built_in">min</span>() - <span class="number">1</span>, X[:, <span class="number">1</span>].<span class="built_in">max</span>() + <span class="number">1</span></span><br><span class="line">    xx, yy = np.meshgrid(np.arange(x_min, x_max, plot_step),</span><br><span class="line">                         np.arange(y_min, y_max, plot_step))</span><br><span class="line"></span><br><span class="line">    Z = clf.predict(np.c_[xx.ravel(), yy.ravel()])</span><br><span class="line">    Z = Z.reshape(xx.shape)</span><br><span class="line">    ax.contourf(xx, yy, Z, alpha=<span class="number">0.4</span>)</span><br><span class="line">    ax.scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], alpha=<span class="number">0.8</span>, c=y, edgecolor=<span class="string">&#x27;k&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X, y = create_dataset()</span><br><span class="line">Counter(y)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 验证数据不同平衡率对模型的影响，如线性SVM</span></span><br><span class="line">fig, ((ax1, ax2), (ax3, ax4)) = plt.subplots(<span class="number">2</span>, <span class="number">2</span>, figsize=(<span class="number">15</span>, <span class="number">12</span>))</span><br><span class="line"></span><br><span class="line">ax_arr = (ax1, ax2, ax3, ax4)</span><br><span class="line">weights_arr = ((<span class="number">0.01</span>, <span class="number">0.01</span>, <span class="number">0.98</span>), (<span class="number">0.01</span>, <span class="number">0.05</span>, <span class="number">0.94</span>),</span><br><span class="line">               (<span class="number">0.2</span>, <span class="number">0.1</span>, <span class="number">0.7</span>), (<span class="number">0.33</span>, <span class="number">0.33</span>, <span class="number">0.33</span>))</span><br><span class="line"><span class="keyword">for</span> ax, weights <span class="keyword">in</span> <span class="built_in">zip</span>(ax_arr, weights_arr):</span><br><span class="line">    X, y = create_dataset(n_samples=<span class="number">1000</span>, weights=weights)</span><br><span class="line">    clf = LinearSVC().fit(X, y)</span><br><span class="line">    plot_decision_function(X, y, clf, ax)</span><br><span class="line">    ax.set_title(<span class="string">&#x27;Linear SVC with y=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(Counter(y)))</span><br><span class="line">fig.tight_layout()</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/blog/imgs/output_11_0.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 采用随机采样来平衡数据集：</span></span><br><span class="line">fig, (ax1, ax2) = plt.subplots(<span class="number">1</span>, <span class="number">2</span>, figsize=(<span class="number">15</span>, <span class="number">7</span>))</span><br><span class="line">X, y = create_dataset(n_samples=<span class="number">10000</span>, weights=(<span class="number">0.01</span>, <span class="number">0.05</span>, <span class="number">0.94</span>))</span><br><span class="line">clf = LinearSVC().fit(X, y)</span><br><span class="line">plot_decision_function(X, y, clf, ax1)</span><br><span class="line">ax1.set_title(<span class="string">&#x27;Linear SVC with y=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(Counter(y)))</span><br><span class="line">pipe = make_pipeline(RandomOverSampler(random_state=<span class="number">0</span>), LinearSVC())</span><br><span class="line">pipe.fit(X, y)</span><br><span class="line">plot_decision_function(X, y, pipe, ax2)</span><br><span class="line">ax2.set_title(<span class="string">&#x27;Decision function for RandomOverSampler&#x27;</span>)</span><br><span class="line">fig.tight_layout()</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/blog/imgs/output_12_0.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 其它高级的过采样算法：ADASYN和SMOTE</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FakeSampler</span>(<span class="params">BaseSampler</span>):</span></span><br><span class="line"></span><br><span class="line">    _sampling_type = <span class="string">&#x27;bypass&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_fit_resample</span>(<span class="params">self, X, y</span>):</span></span><br><span class="line">        <span class="keyword">return</span> X, y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fig, ((ax1, ax2), (ax3, ax4)) = plt.subplots(<span class="number">2</span>, <span class="number">2</span>, figsize=(<span class="number">15</span>, <span class="number">15</span>))</span><br><span class="line">X, y = create_dataset(n_samples=<span class="number">10000</span>, weights=(<span class="number">0.01</span>, <span class="number">0.05</span>, <span class="number">0.94</span>))</span><br><span class="line">sampler = FakeSampler()</span><br><span class="line">clf = make_pipeline(sampler, LinearSVC())</span><br><span class="line">plot_resampling(X, y, sampler, ax1)</span><br><span class="line">ax1.set_title(<span class="string">&#x27;Original data - y=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(Counter(y)))</span><br><span class="line"></span><br><span class="line">ax_arr = (ax2, ax3, ax4)</span><br><span class="line"><span class="keyword">for</span> ax, sampler <span class="keyword">in</span> <span class="built_in">zip</span>(ax_arr, (RandomOverSampler(random_state=<span class="number">0</span>),</span><br><span class="line">                                SMOTE(random_state=<span class="number">0</span>),</span><br><span class="line">                                ADASYN(random_state=<span class="number">0</span>))):</span><br><span class="line">    clf = make_pipeline(sampler, LinearSVC())</span><br><span class="line">    clf.fit(X, y)</span><br><span class="line">    plot_resampling(X, y, sampler, ax)</span><br><span class="line">    ax.set_title(<span class="string">&#x27;Resampling using &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(sampler.__class__.__name__))</span><br><span class="line">fig.tight_layout()</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/blog/imgs/output_13_0.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">fig, (ax1, ax2, ax3) = plt.subplots(<span class="number">1</span>, <span class="number">3</span>, figsize=(<span class="number">20</span>, <span class="number">6</span>))</span><br><span class="line">X, y = create_dataset(n_samples=<span class="number">10000</span>, weights=(<span class="number">0.01</span>, <span class="number">0.05</span>, <span class="number">0.94</span>))</span><br><span class="line"></span><br><span class="line">clf = LinearSVC().fit(X, y)</span><br><span class="line">plot_decision_function(X, y, clf, ax1)</span><br><span class="line">ax1.set_title(<span class="string">&#x27;Linear SVC with y=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(Counter(y)))</span><br><span class="line">sampler = SMOTE()</span><br><span class="line">clf = make_pipeline(sampler, LinearSVC())</span><br><span class="line">clf.fit(X, y)</span><br><span class="line">plot_decision_function(X, y, clf, ax2)</span><br><span class="line">ax2.set_title(<span class="string">&#x27;Decision function for &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(sampler.__class__.__name__))</span><br><span class="line">sampler = ADASYN()</span><br><span class="line">clf = make_pipeline(sampler, LinearSVC())</span><br><span class="line">clf.fit(X, y)</span><br><span class="line">plot_decision_function(X, y, clf, ax3)</span><br><span class="line">ax3.set_title(<span class="string">&#x27;Decision function for &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(sampler.__class__.__name__))</span><br><span class="line">fig.tight_layout()</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/blog/imgs/output_14_0.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不同过采样方法对分类器的影响</span></span><br><span class="line">fig, ((ax1, ax2), (ax3, ax4)) = plt.subplots(<span class="number">2</span>, <span class="number">2</span>, figsize=(<span class="number">15</span>, <span class="number">15</span>))</span><br><span class="line">X, y = create_dataset(n_samples=<span class="number">5000</span>, weights=(<span class="number">0.01</span>, <span class="number">0.05</span>, <span class="number">0.94</span>),</span><br><span class="line">                      class_sep=<span class="number">0.8</span>)</span><br><span class="line"></span><br><span class="line">ax_arr = ((ax1, ax2), (ax3, ax4))</span><br><span class="line"><span class="keyword">for</span> ax, sampler <span class="keyword">in</span> <span class="built_in">zip</span>(ax_arr, (SMOTE(random_state=<span class="number">0</span>),</span><br><span class="line">                                ADASYN(random_state=<span class="number">0</span>))):</span><br><span class="line">    clf = make_pipeline(sampler, LinearSVC())</span><br><span class="line">    clf.fit(X, y)</span><br><span class="line">    plot_decision_function(X, y, clf, ax[<span class="number">0</span>])</span><br><span class="line">    ax[<span class="number">0</span>].set_title(<span class="string">&#x27;Decision function for &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">        sampler.__class__.__name__))</span><br><span class="line">    plot_resampling(X, y, sampler, ax[<span class="number">1</span>])</span><br><span class="line">    ax[<span class="number">1</span>].set_title(<span class="string">&#x27;Resampling using &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">        sampler.__class__.__name__))</span><br><span class="line">fig.tight_layout()</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/blog/imgs/output_15_0.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 考虑不同SMOTE变种算法对分类器的影响</span></span><br><span class="line">fig, ((ax1, ax2), (ax3, ax4),</span><br><span class="line">      (ax5, ax6), (ax7, ax8),</span><br><span class="line">      (ax9, ax10)) = plt.subplots(<span class="number">5</span>, <span class="number">2</span>, figsize=(<span class="number">15</span>, <span class="number">30</span>))</span><br><span class="line">X, y = create_dataset(n_samples=<span class="number">5000</span>, weights=(<span class="number">0.01</span>, <span class="number">0.05</span>, <span class="number">0.94</span>),</span><br><span class="line">                      class_sep=<span class="number">0.8</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ax_arr = ((ax1, ax2), (ax3, ax4), (ax5, ax6), (ax7, ax8), (ax9, ax10))</span><br><span class="line"><span class="keyword">for</span> ax, sampler <span class="keyword">in</span> <span class="built_in">zip</span>(ax_arr,</span><br><span class="line">                       (SMOTE(random_state=<span class="number">0</span>),</span><br><span class="line">                        BorderlineSMOTE(random_state=<span class="number">0</span>, kind=<span class="string">&#x27;borderline-1&#x27;</span>),</span><br><span class="line">                        BorderlineSMOTE(random_state=<span class="number">0</span>, kind=<span class="string">&#x27;borderline-2&#x27;</span>),</span><br><span class="line">                        KMeansSMOTE(random_state=<span class="number">0</span>),</span><br><span class="line">                        SVMSMOTE(random_state=<span class="number">0</span>))):</span><br><span class="line">    clf = make_pipeline(sampler, LinearSVC())</span><br><span class="line">    clf.fit(X, y)</span><br><span class="line">    plot_decision_function(X, y, clf, ax[<span class="number">0</span>])</span><br><span class="line">    ax[<span class="number">0</span>].set_title(<span class="string">&#x27;Decision function for &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">        sampler.__class__.__name__))</span><br><span class="line">    plot_resampling(X, y, sampler, ax[<span class="number">1</span>])</span><br><span class="line">    ax[<span class="number">1</span>].set_title(<span class="string">&#x27;Resampling using &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(sampler.__class__.__name__))</span><br><span class="line">fig.tight_layout()</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/blog/imgs/output_16_0.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用SMOTE-NC来处理连续变量与离散变量特征</span></span><br><span class="line">rng = np.random.RandomState(<span class="number">42</span>)</span><br><span class="line">n_samples = <span class="number">50</span></span><br><span class="line">X = np.empty((n_samples, <span class="number">3</span>), dtype=<span class="built_in">object</span>)</span><br><span class="line">X[:, <span class="number">0</span>] = rng.choice([<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>], size=n_samples).astype(<span class="built_in">object</span>)</span><br><span class="line">X[:, <span class="number">1</span>] = rng.randn(n_samples)</span><br><span class="line">X[:, <span class="number">2</span>] = rng.randint(<span class="number">3</span>, size=n_samples)</span><br><span class="line">y = np.array([<span class="number">0</span>] * <span class="number">20</span> + [<span class="number">1</span>] * <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;The original imbalanced dataset&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sorted</span>(Counter(y).items()))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;The first and last columns are containing categorical features:&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(X[:<span class="number">5</span>])</span><br><span class="line"></span><br><span class="line">smote_nc = SMOTENC(categorical_features=[<span class="number">0</span>, <span class="number">2</span>], random_state=<span class="number">0</span>)</span><br><span class="line">X_resampled, y_resampled = smote_nc.fit_resample(X, y)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Dataset after resampling:&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sorted</span>(Counter(y_resampled).items()))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;SMOTE-NC will generate categories for the categorical features:&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(X_resampled[-<span class="number">5</span>:])</span><br></pre></td></tr></table></figure><pre><code>The original imbalanced dataset
[(0, 20), (1, 30)]
The first and last columns are containing categorical features:
[['C' -0.14021849735700803 2]
 ['A' -0.033193400066544886 2]
 ['C' -0.7490765234433554 1]
 ['C' -0.7783820070908942 2]
 ['A' 0.948842857719016 2]]
Dataset after resampling:
[(0, 30), (1, 30)]
SMOTE-NC will generate categories for the categorical features:
[['A' 0.5246469549655818 2]
 ['B' -0.3657680728116921 2]
 ['B' 0.9344237230779993 2]
 ['B' 0.3710891618824609 2]
 ['B' 0.3327240726719727 2]]
</code></pre><h2 id="联系作者">联系作者</h2><img src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20200504171717935.gif" style="zoom:50%"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="mailto:undefined">梦家</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://dreamhomes.top/posts/202005281734/">https://dreamhomes.top/posts/202005281734/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://dreamhomes.top" target="_blank">梦家博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%B8%8D%E5%B9%B3%E8%A1%A1%E6%95%B0%E6%8D%AE%E9%9B%86/">不平衡数据集</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/butterflyblog/imgs/img3.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/wechat.png" target="_blank"><img class="post-qr-code-img" data-lazy-src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/wechat.png" alt="wechat"></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" data-lazy-src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/alipay.jpg" alt="alipay"></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/202006010941/"><img class="prev-cover" data-lazy-src="https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/butterflyblog/imgs/img6.jpeg" onerror='onerror=null,src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Python 代码优化技巧（二）</div></div></a></div><div class="next-post pull-right"><a href="/posts/202005262208/"><img class="next-cover" data-lazy-src="https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/butterflyblog/imgs/img3.jpeg" onerror='onerror=null,src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">PyCharm + Jupyter + Docker 搭建远程机器学习开发环境</div></div></a></div></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div><div id="comment-switch"><span class="first-comment">Twikoo</span><span class="switch-btn"></span><span class="second-comment">Valine</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/avatar.gif" onerror='this.onerror=null,this.src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/friend_404.gif"' alt="avatar"><div class="author-info__name">梦家</div><div class="author-info__description">算法工程师｜机器学习<br><br>前 途 似 海 渺 渺<br>来 日 方 长 漫 漫<br>与 其 互 为 人 间<br>不 如 自 成 宇 宙</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">274</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">183</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">63</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/dreamhomes"><i class="fab fa-github"></i><span>Github</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/dreamhomes" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:shenmj13@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://blog.csdn.net/DreamHome_S" target="_blank" title="CSDN"><i class="fab fa-cuttlefish"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>重要通知</span></div><div class="announcement_content">如对本站内容存在任何疑问 🧐 欢迎 <a href="https://dreamhomes.top/comments/">留言</a> 反馈或者联系作者<br><br><center><img src="https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/butterflyblog/imgs/20210910100633.png" alt="联系博主" style="zoom:72%"></center></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">2.</span> <span class="toc-text">解决方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SMOTE-%E8%BF%87%E9%87%87%E6%A0%B7%E6%96%B9%E6%B3%95"><span class="toc-number">3.</span> <span class="toc-text">SMOTE 过采样方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SMOTE-%E9%87%87%E6%A0%B7"><span class="toc-number">3.1.</span> <span class="toc-text">SMOTE 采样</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Borderline-SMOTE-%E9%87%87%E6%A0%B7"><span class="toc-number">3.2.</span> <span class="toc-text">Borderline SMOTE 采样</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SVM-SMOTE-%E9%87%87%E6%A0%B7"><span class="toc-number">3.3.</span> <span class="toc-text">SVM SMOTE 采样</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kmeans-SMOTE-%E9%87%87%E6%A0%B7"><span class="toc-number">3.4.</span> <span class="toc-text">Kmeans SMOTE 采样</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SMOTE-NC-%E9%87%87%E6%A0%B7"><span class="toc-number">3.5.</span> <span class="toc-text">SMOTE-NC 采样</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.6.</span> <span class="toc-text">Python 实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E8%BF%87%E9%87%87%E6%A0%B7%E6%96%B9%E6%B3%95%E7%9A%84%E6%AF%94%E8%BE%83"><span class="toc-number">4.</span> <span class="toc-text">不同过采样方法的比较</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%94%E7%B3%BB%E4%BD%9C%E8%80%85"><span class="toc-number">5.</span> <span class="toc-text">联系作者</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/202204281516/" title="智能运维 AIOps 系列丨调用链根因定位算法综述"><img data-lazy-src="https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/butterflyblog/imgs/img12.jpeg" onerror='this.onerror=null,this.src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/404.jpg"' alt="智能运维 AIOps 系列丨调用链根因定位算法综述"></a><div class="content"><a class="title" href="/posts/202204281516/" title="智能运维 AIOps 系列丨调用链根因定位算法综述">智能运维 AIOps 系列丨调用链根因定位算法综述</a><time datetime="2022-04-28T15:16:58.000Z" title="发表于 2022-04-28 15:16:58">2022-04-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/202204241101/" title="Chart Studio &amp; Datapane：优雅地将 Plotly 图嵌入到 Markdown 文件中进行可视化分析"><img data-lazy-src="https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/butterflyblog/imgs/img6.jpeg" onerror='this.onerror=null,this.src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/404.jpg"' alt="Chart Studio &amp; Datapane：优雅地将 Plotly 图嵌入到 Markdown 文件中进行可视化分析"></a><div class="content"><a class="title" href="/posts/202204241101/" title="Chart Studio &amp; Datapane：优雅地将 Plotly 图嵌入到 Markdown 文件中进行可视化分析">Chart Studio &amp; Datapane：优雅地将 Plotly 图嵌入到 Markdown 文件中进行可视化分析</a><time datetime="2022-04-24T11:01:59.000Z" title="发表于 2022-04-24 11:01:59">2022-04-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/202204221627/" title="ICSE 2022丨DeepTraLog：GNN 和 Trace-Log 数据相结合的微服务异常检测方法"><img data-lazy-src="https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/butterflyblog/imgs/img9.jpeg" onerror='this.onerror=null,this.src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/404.jpg"' alt="ICSE 2022丨DeepTraLog：GNN 和 Trace-Log 数据相结合的微服务异常检测方法"></a><div class="content"><a class="title" href="/posts/202204221627/" title="ICSE 2022丨DeepTraLog：GNN 和 Trace-Log 数据相结合的微服务异常检测方法">ICSE 2022丨DeepTraLog：GNN 和 Trace-Log 数据相结合的微服务异常检测方法</a><time datetime="2022-04-22T16:27:43.000Z" title="发表于 2022-04-22 16:27:43">2022-04-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/202204221003/" title="齐夫定律 (Zipf' law) 理论及其应用场景"><img data-lazy-src="https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/butterflyblog/imgs/img6.jpeg" onerror='this.onerror=null,this.src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/404.jpg"' alt="齐夫定律 (Zipf' law) 理论及其应用场景"></a><div class="content"><a class="title" href="/posts/202204221003/" title="齐夫定律 (Zipf' law) 理论及其应用场景">齐夫定律 (Zipf' law) 理论及其应用场景</a><time datetime="2022-04-22T10:03:07.000Z" title="发表于 2022-04-22 10:03:07">2022-04-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/202204201700/" title="大规模图可视化分析框架 Graphistry"><img data-lazy-src="https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/butterflyblog/imgs/img2.jpeg" onerror='this.onerror=null,this.src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/404.jpg"' alt="大规模图可视化分析框架 Graphistry"></a><div class="content"><a class="title" href="/posts/202204201700/" title="大规模图可视化分析框架 Graphistry">大规模图可视化分析框架 Graphistry</a><time datetime="2022-04-20T17:00:42.000Z" title="发表于 2022-04-20 17:00:42">2022-04-20</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(https://cdn.jsdelivr.net/gh/dreamhomes/blog-image-bed@master/top/dreamhomes/butterflyblog/imgs/img3.jpeg)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 梦家</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/"><img src="https://cdn.jsdelivr.net/gh/dreamhomes/dreamhomes.github.io@master/img/icp.png"> <span>赣ICP备 20003744 号</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div></div><hr><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",preloader.endLoading())</script><div class="js-pjax"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.css"><script>document.querySelectorAll("#article-container span.katex-display").forEach(a=>{btf.wrap(a,"div","","katex-wrap")})</script><script>document.getElementsByClassName("mermaid").length&&(window.mermaidJsLoad?mermaid.init():getScript("https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js").then(()=>{window.mermaidJsLoad=!0,mermaid.initialize({theme:"default"})}))</script><script>(()=>{const o=document.getElementById("twikoo-count"),t=()=>{let o={el:"#twikoo-wrap",envId:"hello-cloudbase-7gmvk17h649821e3",region:""};twikoo.init(o)},e=()=>{twikoo.getCommentsCount({envId:"hello-cloudbase-7gmvk17h649821e3",region:"",urls:[window.location.pathname],includeReply:!1}).then((function(t){o.innerText=t[0].count})).catch((function(o){console.error(o)}))},n=(n=!1)=>{"object"==typeof twikoo?(t(),n&&o&&setTimeout(e,0)):getScript("https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js").then(()=>{t(),n&&o&&setTimeout(e,0)})};n(!0)})()</script><script>function loadValine(){function e(){let e={el:"#vcomment",appId:"1JeI4r7MuSNuHIKgevu6uP8q-gzGzoHsz",appKey:"Ykl58TSExNWvTIyBTbnmp26h",placeholder:"💗 Hi, see you tomorrow. 💗",avatar:"monsterid",meta:"nick,mail,link".split(","),pageSize:"10",lang:"zh-CN",recordIP:!1,serverURLs:"https://1jei4r7m.lc-cn-n1-shared.com",emojiCDN:"",emojiMaps:"",enableQQ:!1,path:window.location.pathname,master:"7a7f78ed775ede7059cf68eb46898cc5".split(","),friends:"5d7570d1f1fefc9918c797ee65af3899,ec18c657f7ea8128e4bb73e96e45d236,d304727a8d439e45b08f8579666ee818".split(","),tagMeta:"博主,伙伴,访客".split(",")};e.requiredFields="nick,mail".split(",");new Valine(e)}"function"==typeof Valine?e():getScript("https://cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js").then(e)}{function loadOtherComment(){loadValine()}setTimeout(loadValine,0)}</script></div><script defer id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>function gitcalendar_injector_config(){document.getElementById("recent-posts").insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 280px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>'),console.log("已挂载gitcalendar")}document.getElementById("recent-posts")&&"/"===location.pathname&&(gitcalendar_injector_config(),GitCalendarInit("https://gitcalendar.akilar.top/api?dreamhomes",["#ebedf0","#fdcdec","#fc9bd9","#fa6ac5","#f838b2","#f5089f","#c4067e","#92055e","#540336","#48022f","#30021f"],"dreamhomes"))</script></body></html>